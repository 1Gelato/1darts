<%
  // Resolve related products from slugs
  const relatedProducts = product.related
    .map(slug => allProducts.find(p => p.slug === slug))
    .filter(Boolean)
    .filter(p => p.slug !== product.slug);
-%>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%- product.pageTitle %></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/product-style.css">
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="grid-lines"></div>
    <div id="navbar-placeholder"></div>

    <!-- Breadcrumb -->
    <div class="page-header">
        <div class="page-header-container">
            <ul class="breadcrumb">
                <li><a href="../index.html">Accueil</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="../index.html#products">Produits</a></li>
                <li><span class="separator">/</span></li>
                <li><span class="current"><%- product.name %></span></li>
            </ul>
        </div>
    </div>

    <!-- Product Hero -->
    <section class="product-hero">
        <div class="product-hero-container">
            <div class="product-hero-image">
                <div class="product-hero-glow"></div>
<% if (product.image && product.image.src) { -%>
                <img src="../<%- product.image.src %>" alt="<%- product.image.alt %>">
<% } else { -%>
                <div class="placeholder-icon">&#127919;</div>
<% } -%>
            </div>
            <div class="product-hero-details">
                <span class="product-hero-badge"><%- product.badge %></span>
                <h1><%- product.name %></h1>
                <p class="product-subtitle"><%- product.subtitle %></p>
                <p class="product-description"><%- product.description %></p>
                <div class="product-hero-cta">
                    <a href="../index.html#contact" class="btn-primary">Demander un devis</a>
                    <a href="tel:+33954934990" class="btn-secondary">Nous appeler</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Specs -->
    <section class="product-specs-section">
        <div class="product-specs-container">
            <div class="section-header">
                <span class="section-tag">Caractéristiques</span>
                <h2><%- product.specs.sectionTitle %></h2>
            </div>
            <div class="specs-grid">
<% product.specs.items.forEach(function(spec) { -%>
                <div class="spec-card">
                    <div class="spec-card-icon"><%- spec.icon %></div>
                    <h4><%- spec.label %></h4>
                    <div class="spec-card-value"><%- spec.value %></div>
                </div>
<% }); -%>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section class="product-features">
        <div class="product-features-container">
            <div class="section-header">
                <span class="section-tag">Points forts</span>
                <h2><%- product.features.sectionTitle %></h2>
            </div>
            <div class="features-list">
<% product.features.items.forEach(function(feature) { -%>
                <div class="feature-item">
                    <div class="feature-icon"><%- feature.icon %></div>
                    <div class="feature-content">
                        <h4><%- feature.title %></h4>
                        <p><%- feature.description %></p>
                    </div>
                </div>
<% }); -%>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="product-cta-section">
        <div class="product-cta-container">
            <h2><%- product.cta.title %></h2>
            <p><%- product.cta.text %></p>
            <div class="product-cta-buttons">
                <a href="../<%- product.cta.primary.href %>" class="btn-primary"><%- product.cta.primary.text %></a>
<% if (product.cta.secondary.href.startsWith('tel:')) { -%>
                <a href="<%- product.cta.secondary.href %>" class="btn-secondary"><%- product.cta.secondaryLabel %></a>
<% } else { -%>
                <a href="../<%- product.cta.secondary.href %>" class="btn-secondary"><%- product.cta.secondary.text %></a>
<% } -%>
            </div>
        </div>
    </section>

    <!-- Other Products -->
    <section class="other-products">
        <div class="other-products-container">
            <div class="section-header">
                <span class="section-tag">Voir aussi</span>
                <h2>NOS AUTRES MODÈLES</h2>
            </div>
            <div class="other-products-grid">
<% relatedProducts.forEach(function(related) { -%>
                <div class="other-product-card">
<% if (related.image && related.image.src) { -%>
                    <img src="../<%- related.image.src %>" alt="<%- related.name %>">
<% } else { -%>
                    <span class="placeholder-icon">&#127919;</span>
<% } -%>
                    <h4><%- related.name %></h4>
                    <p><%- related.otherProductCard.subtitle %></p>
                    <a href="<%- related.slug %>.html" class="btn-secondary">Découvrir</a>
                </div>
<% }); -%>
            </div>
        </div>
    </section>

    <div id="footer-placeholder"></div>

    <script src="../js/navbar.js"></script>
    <script src="../js/footer.js"></script>
    <script src="../js/main.js"></script>
</body>
</html>
